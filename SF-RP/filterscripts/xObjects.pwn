#include <a_samp>

forward Timer();
forward SetPlayerPosWithObjects(playerid,Float:x,Float:y,Float:z);
/*
	SetPlayerPosWithObjects usage in your gamemode:

		CallRemoteFunction("SetPlayerPosWithObjects","ifff",playerid,newx,newy,newz);
*/

//------------------------------------------------------------------------------

enum object_info
{
	modelid,
	Float:ox,
	Float:oy,
	Float:oz,
	Float:orx,
	Float:ory,
	Float:orz,
	Float:viewdist
}

new Objects[][object_info] = {
	{11507, 1460.113281, -108.135841, 194.861435, 0.0, 0.0, 180.0, 1000.0},
	{11507, 1214.021240, -107.197754, 197.665619, 0.0, 0.0, 180.0,1000.0},
	{11507, 960.208008, -106.939079, 217.257339, 0.0, 0.0, 180.0,1000.0},
//----------------------------MIS OBJETOS-------------------------------------//
//----------AEROPUERTO SF-----------//
	{14819, -1420.8273, -286.8808, 14.1383, 0.0000, 0.0000, 315.0000, 500.0},
	{14819, -1421.0593, -286.9752, 14.1484, 0.0000, 0.0000, 146.2500, 500.0},
	{989, -1543.7183, -432.6966, 6.8094, 0.0000, 0.0000, 241.4840, 500.0},
	{989, -1547.7771, -428.6261, 6.8019, 0.0000, 0.0000, 242.3434, 500.0},
	{14819, -1425.3997, -283.1724, 14.1499, 0.0000, 0.8594, 321.0161, 500.0},
	{14819, -1425.6097, -283.4024, 14.1484, 0.0000, 359.1406, 157.4227, 500.0},
	{2792, -1425.4174, -283.2191, 15.9091, 0.0000, 0.0000, 327.1094, 500.0},
	{2793, -1420.9076, -286.8331, 15.9171, 0.0000, 0.0000, 320.2340, 500.0},
	{14819, -1416.2655, -290.6822, 14.1984, 0.0000, 0.0000, 315.0000, 500.0},
	{14819, -1416.4861, -290.9058, 14.1984, 0.0000, 0.0000, 146.2500, 500.0},
	{2794, -1416.3228, -290.7113, 15.9727, 0.0000, 0.0000, 319.3745, 500.0},
	{972, -1425.4805, -282.4950, 4.3719, 0.0000, 0.0000, 229.2978, 500.0},
	{972, -1409.0134, -297.8297, 4.3719, 0.0000, 0.0000, 222.4217, 500.0},
	{1311, -1707.6971, -586.7770, 15.1772, 0.0000, 180.4817, 195.0922, 500.0},
	{1256, -1434.0145, -281.0581, 13.8079, 0.0000, 0.0000, 57.9688, 500.0},
	{1256, -1438.9379, -277.9482, 13.8079, 0.0000, 0.0000, 57.9688, 500.0},
	{1256, -1410.5374, -300.3084, 13.8079, 0.0000, 0.0000, 41.5622, 500.0},
	{1256, -1406.3185, -305.0627, 13.8079, 0.0000, 0.0000, 41.5622, 500.0},
	{1216, -1473.2617, -266.2113, 13.8404, 0.0000, 0.0000, 348.7500, 500.0},
	{4726, -1418.0693, -260.8772, 23.1343, 0.0000, 0.0000, 235.3133, 500.0},
	{4726, -1376.9738, -299.8468, 23.1593, 0.0000, 0.0000, 213.7500, 500.0},
	{1229, -1456.1429, -275.5938, 14.7008, 0.0000, 0.0000, 64.1396, 500.0},
	{1234, -1473.3022, -270.8591, 14.7081, 0.0000, 0.0000, 337.5000, 500.0},
	{1216, -1475.6183, -265.8806, 13.8404, 0.0000, 0.0000, 348.7500, 500.0},
	{1216, -1477.9764, -265.5690, 13.8404, 0.0000, 0.0000, 350.4688, 500.0},
	{1216, -1480.3752, -265.2665, 13.8404, 0.0000, 0.0000, 350.4688, 500.0},
	{1216, -1482.6869, -264.8968, 13.8404, 0.0000, 0.0000, 350.4688, 500.0},
	{1257, -1468.5029, -266.0807, 14.4336, 0.0000, 0.0000, 75.3123, 500.0},
	{11292, -1426.6346, -257.4108, 25.9015, 0.0000, 0.0000, 56.2500, 500.0},
	{11292, -1383.5774, -293.5794, 25.9015, 0.0000, 0.0000, 33.7500, 500.0},
	{11292, -1410.7489, -232.8779, 14.6125, 0.0000, 0.0000, 146.2500, 500.0},
	{11292, -1367.4662, -268.6810, 14.6125, 0.0000, 0.0000, 135.0000, 500.0},
	{970, -1459.8259, -266.1181, 13.7059, 0.0000, 0.0000, 252.6566, 500.0},
	{970, -1454.3999, -267.6553, 13.7706, 0.0000, 0.0000, 252.6566, 500.0},
	{970, -1457.0533, -266.9278, 13.7059, 0.0000, 0.0000, 252.6566, 500.0},
	{1223, -1471.4495, -267.0133, 13.1362, 0.0000, 0.0000, 258.7500, 500.0},
	{1256, -1444.0638, -275.4227, 13.8079, 0.0000, 0.0000, 66.6405, 500.0},
	{1256, -1402.5719, -309.3333, 13.8079, 0.0000, 0.0000, 39.8434, 500.0},
	{1233, -1416.5177, -301.0520, 14.7081, 0.0000, 0.0000, 45.0000, 500.0},
	{1215, -1415.2778, -302.2863, 13.7054, 0.0000, 0.0000, 0.0000, 500.0},
	{1215, -1434.1968, -286.6916, 13.7128, 0.0000, 0.0000, 0.0000, 500.0},
	{1289, -1414.9340, -295.8248, 13.7275, 0.0000, 0.0000, 135.0000, 500.0},
	{1287, -1414.3508, -296.3620, 13.7275, 0.0000, 0.0000, 135.0000, 500.0},
	{1286, -1413.7482, -296.9002, 13.7275, 0.0000, 0.0000, 135.0000, 500.0},
	{1285, -1413.1509, -297.4097, 13.7275, 0.0000, 0.0000, 135.0000, 500.0},
	{996, -1414.0116, -304.0114, 13.8899, 0.0000, 0.0000, 310.7028, 500.0},
	{997, -1408.7599, -310.0494, 13.2414, 0.0000, 0.0000, 309.7660, 500.0},
	{997, -1442.6199, -281.5640, 13.2488, 0.0000, 0.0000, 155.7811, 500.0},
	{996, -1435.6632, -285.8275, 13.8972, 0.0000, 0.0000, 148.9056, 500.0},
	{1215, -1415.9653, -301.5729, 13.7054, 0.0000, 0.0000, 0.0000, 500.0},
	{1215, -1433.5443, -287.1166, 13.7128, 0.0000, 0.0000, 0.0000, 500.0},
	{2754, -1487.0339, -264.4209, 14.0506, 0.0000, 0.0000, 82.2651, 500.0},
	{2754, -1488.0378, -263.1835, 14.0506, 0.0000, 0.0000, 358.3585, 500.0},
	{9241, -1356.2102, -353.0407, 26.1214, 0.0000, 0.0000, 186.8160, 500.0},
	{9241, -1466.4099, -242.6212, 26.1214, 0.0000, 0.0000, 79.5500, 500.0},
//----------AEROPUERTO SF-----------//
//---------HQ SUNNYSIDE--------//
	{14602, -1691.1978, 1014.5930, -69.7826, 0.0000, 0.0000, 0.0000, 500.0},
	{1649, -1694.0258, 1020.2594, -73.3763, 0.0000, 0.0000, 0.0000, 500.0},
	{1649, -1689.6666, 1020.2844, -73.4338, 0.0000, 0.0000, 0.0000, 500.0},
	{1649, -1698.8247, 1022.5802, -73.3881, 0.0000, 0.0000, 270.0000, 500.0},
	{1649, -1698.8247, 1026.9425, -73.3970, 0.0000, 0.0000, 270.0000, 500.0},
	{1649, -1698.7496, 1031.3181, -73.3601, 0.0000, 0.0000, 270.0000, 500.0},
	{1649, -1693.9828, 1020.4356, -73.3841, 0.0000, 0.0000, 180.0000, 500.0},
	{1649, -1689.6227, 1020.4356, -73.3449, 0.0000, 0.0000, 180.0000, 500.0},
	{1649, -1698.6484, 1022.4923, -73.4158, 0.0000, 0.0000, 90.0001, 500.0},
	{1649, -1698.6234, 1026.8354, -73.4054, 0.0000, 0.0000, 90.0001, 500.0},
	{1649, -1698.6234, 1031.1855, -73.4273, 0.0000, 0.0000, 90.0001, 500.0},
	{974, -1694.5825, 1007.3875, -72.3255, 0.0000, 0.0000, 0.0000, 500.0},
	{974, -1701.8243, 1030.3445, -72.3255, 0.0000, 0.0000, 180.0000, 500.0},
	{1555, -1701.9307, 1030.7871, -75.1312, 0.0000, 0.0000, 0.0000, 500.0},
	{1555, -1696.4357, 1006.8969, -75.0965, 0.0000, 0.0000, 0.0000, 500.0},
	{1444, -1709.3372, 1009.6024, -74.3451, 0.0000, 0.0000, 270.0000, 500.0},
	{1444, -1709.3706, 1019.5457, -74.3451, 0.0000, 0.0000, 270.0000, 500.0},
	{955, -1697.9760, 1029.8438, -74.7403, 0.0000, 0.0000, 0.0000, 500.0},
	{956, -1696.6997, 1029.9202, -74.7393, 0.0000, 0.0000, 0.0000, 500.0},
	{1723, -1691.7942, 1026.5156, -75.1452, 0.0000, 0.0000, 270.0000, 500.0},
	{1724, -1692.6440, 1028.3966, -75.1453, 0.0000, 0.0000, 315.0000, 500.0},
	{1724, -1691.9423, 1023.3694, -75.1518, 0.0000, 0.0000, 225.0000, 500.0},
	{1724, -1694.5298, 1028.3530, -75.1453, 0.0000, 0.0000, 0.0000, 500.0},
	{2311, -1693.9332, 1026.2032, -75.1510, 0.0000, 0.0000, 270.0000, 500.0},
	{1724, -1693.3707, 1022.4285, -75.1518, 0.0000, 0.0000, 180.0000, 500.0},
	{741, -1692.7041, 1021.3163, -74.8166, 0.0000, 0.0000, 90.0000, 500.0},
	{802, -1691.3080, 1021.4452, -74.0983, 0.0000, 0.0000, 157.5000, 500.0},
	{1510, -1693.9258, 1025.3906, -74.6337, 0.0000, 0.0000, 0.0000, 500.0},
	{1546, -1693.8645, 1024.6809, -74.5564, 0.0000, 0.0000, 0.0000, 500.0},
	{1546, -1694.1697, 1024.8762, -74.5564, 0.0000, 0.0000, 0.0000, 500.0},
	{2606, -1708.1604, 1012.4438, -74.1979, 0.0000, 0.0000, 225.0000, 500.0},
	{2609, -1713.8301, 1017.3942, -74.4071, 0.0000, 0.0000, 90.0000, 500.0},
	{2191, -1713.7522, 1012.8117, -75.1532, 0.0000, 0.0000, 90.0000, 500.0},
	{2164, -1714.1575, 1014.3308, -75.1564, 0.0000, 0.0000, 90.0000, 500.0},
	{2606, -1708.5425, 1016.9468, -74.1979, 0.0000, 0.0000, 326.2500, 500.0},
	{16377, -1697.7638, 1025.3262, -74.1630, 0.0000, 0.0000, 270.0000, 500.0},
	{2332, -1713.7935, 1016.0861, -74.6869, 0.0000, 0.0000, 90.0000, 500.0},
	{2609, -1713.8370, 1016.8671, -74.4181, 0.0000, 0.0000, 90.0000, 500.0},
	{1806, -1709.1066, 1013.8293, -75.1301, 0.0000, 0.0000, 247.5000, 500.0},
	{1806, -1709.1616, 1015.4367, -75.1236, 0.0000, 0.0000, 292.5000, 500.0},
	{2190, -1707.0859, 1013.3687, -74.4210, 0.0000, 0.0000, 236.2501, 500.0},
	{2190, -1707.1235, 1015.5485, -74.4277, 0.0000, 0.0000, 258.7500, 500.0},
	{2186, -1711.5509, 1017.8995, -75.1632, 0.0000, 0.0000, 270.0000, 500.0},
	{1808, -1695.7656, 1029.9940, -75.1485, 0.0000, 0.0000, 0.0000, 500.0},
	{1257, -1757.9921, 908.0360, 25.1698, 0.0000, 0.0000, 270.0000, 500.0},
	{2754, -1702.1222, 956.6211, 24.7928, 0.0000, 0.0000, 0.0000, 500.0},
	{638, -1733.2578, 960.8841, 25.2048, 0.0000, 0.0000, 270.0000, 500.0},
	{638, -1729.3981, 960.8666, 25.2048, 0.0000, 0.0000, 270.0000, 500.0},
	{638, -1774.6884, 960.8974, 25.2048, 0.0000, 0.0000, 270.0000, 500.0},
	{638, -1778.5521, 960.9097, 25.2048, 0.0000, 0.0000, 270.0000, 500.0},
	{1557, -1755.6470, 963.8431, 23.8600, 0.0000, 0.0000, 0.0000, 500.0},
	{1557, -1752.6509, 963.8345, 23.8648, 0.0000, 0.0000, 180.0000, 500.0},
	{18553, -1754.0830, 963.9075, 25.5748, 0.0000, 0.0000, 88.2811, 500.0},
	{1569, -1700.4303, 998.9006, -75.1208, 0.0000, 0.0000, 180.0000, 500.0},
	{1223, -1755.0304, 909.0786, 23.8784, 0.0000, 0.0000, 90.0000, 500.0}
//---------HQ SUNNYSIDE--------//
//----------------------------MIS OBJETOS FIN---------------------------------//
	// {modelid,x,y,z,rotx,roty,rotz,viewdistance}
	// all params are same as create object, except there is an additional viewdistance parameter. This is the distance
	// a player should be to see the object
};

enum player_info
{
	objid[sizeof(Objects)],
	bool:view[sizeof(Objects)]
}
new Player[MAX_PLAYERS][player_info];

//------------------------------------------------------------------------------

bool:IsInReach(Float:x,Float:y,Float:z,Float:x2,Float:y2,Float:z2,Float:dist)
{
	x = (x > x2) ? x - x2 : x2 - x;
	if(x > dist) return false;
	y = (y > y2) ? y - y2 : y2 - y;
	if(y > dist) return false;
	z = (z > z2) ? z - z2 : z2 - z;
	if(z > dist) return false;
	return true;
}

//------------------------------------------------------------------------------

new timer;

public OnFilterScriptInit()
{
	print("---\nLoaded xObjects by Boylett\n---");
	timer = SetTimer("Timer",500,1);
	return 1;
}

public OnFilterScriptExit()
{
	for(new i = 0; i < MAX_PLAYERS; i++)
	{
		for(new o = 0; o < sizeof(Objects); o++)
		{
			if(Player[i][view][o])
			{
				Player[i][view][o] = false;
				DestroyPlayerObject(i,Player[i][objid][o]);
			}
		}
	}
	
	KillTimer(timer);
}

//------------------------------------------------------------------------------

public OnPlayerConnect(playerid)
{
	for(new i = 0; i < sizeof(Objects); i++) Player[playerid][view][i] = false;
}

public OnPlayerDisconnect(playerid)
{
	for(new i = 0; i < sizeof(Objects); i++)
	{
		if(Player[playerid][view][i])
		{
			Player[playerid][view][i] = false;
			DestroyPlayerObject(playerid,Player[playerid][objid][i]);
		}
	}
}

//------------------------------------------------------------------------------

public Timer()
{
	for(new i = 0; i < MAX_PLAYERS; i++)
		if(IsPlayerConnected(i))
		    PlayerObjectUpdate(i);
}

PlayerObjectUpdate(playerid)
{
	new Float:pos[3];
	GetPlayerPos(playerid,pos[0],pos[1],pos[2]);
	for(new i = 0; i < sizeof(Objects); i++)
	{
	    if(!Player[playerid][view][i])
	    {
	        if(IsInReach(pos[0],pos[1],pos[2],Objects[i][ox],Objects[i][oy],Objects[i][oz],Objects[i][viewdist]))
	        {
	            Player[playerid][view][i] = true;
	            Player[playerid][objid][i] = CreatePlayerObject(playerid,Objects[i][modelid],Objects[i][ox],Objects[i][oy],Objects[i][oz],Objects[i][orx],Objects[i][ory],Objects[i][orz]);
	        }
	    } else if(!IsInReach(pos[0],pos[1],pos[2],Objects[i][ox],Objects[i][oy],Objects[i][oz],Objects[i][viewdist]))
	    {
            Player[playerid][view][i] = false;
            DestroyPlayerObject(playerid,Player[playerid][objid][i]);
	    }
	}
}

public SetPlayerPosWithObjects(playerid,Float:x,Float:y,Float:z)
{
	for(new i = 0; i < sizeof(Objects); i++)
	{
	    if(!Player[playerid][view][i])
	    {
	        if(IsInReach(x,y,z,Objects[i][ox],Objects[i][oy],Objects[i][oz],Objects[i][viewdist]))
	        {
	            Player[playerid][view][i] = true;
	            Player[playerid][objid][i] = CreatePlayerObject(playerid,Objects[i][modelid],Objects[i][ox],Objects[i][oy],Objects[i][oz],Objects[i][orx],Objects[i][ory],Objects[i][orz]);
	        }
	    } else if(!IsInReach(x,y,z,Objects[i][ox],Objects[i][oy],Objects[i][oz],Objects[i][viewdist]))
	    {
            Player[playerid][view][i] = false;
            DestroyPlayerObject(playerid,Player[playerid][objid][i]);
	    }
	}
	SetPlayerPos(playerid,Float:x,Float:y,Float:z);
}

public OnPlayerSpawn(playerid)
	PlayerObjectUpdate(playerid);
